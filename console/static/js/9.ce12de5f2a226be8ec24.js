webpackJsonp([9],{"7sEC":function(t,e,s){var a=s("gxl0");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);s("rjj0")("31b8676a",a,!0)},V6Wp:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("mvHQ"),i=s.n(a),o=s("odxq"),r=s.n(o),l=s("vLgD");var n=s("M9A7"),d={name:"knowledge-list",data:function(){return{defaultCover:r.a,noteList:null,docList:null,ruleForm:{id:void 0,name:"",slug:"",type:"",description:"",cover_image:0},showDialogForm:!1,dialogStatus:"",statusMap:{update:"edit",create:"create"},typeStatus:"",typeMap:{note:"Note",doc:"Doc"},limitUploadNumber:1,uploadUrl:"/api/media",uploadHeaders:{Authorization:""},uploadParams:{userId:"",usage:"cover"},rules:{name:[{required:!0,message:this.$t("knowledge.pleaseInputName"),trigger:["blur","change"]},{max:200,message:this.$t("knowledge.pleaseCheckNameLength"),trigger:["blur","change"]}],slug:[{max:200,message:this.$t("knowledge.pleaseCheckSlugLength"),trigger:["blur","change"]}],description:[{max:500,message:this.$t("knowledge.pleaseCheckDescriptionLength"),trigger:["blur","change"]}]},coverImagesList:{}}},created:function(){this.setTitle(),this.getList(),this.handleUploadAuth()},methods:{setTitle:function(){document.title=this.$t("route."+this.$route.meta.title)+" | Puti"},resetForm:function(t){void 0!==this.$refs.upload&&this.$refs.upload.clearFiles(),void 0!==this.$refs[t]&&this.$refs[t].resetFields(),"{}"!==i()(this.coverImagesList)&&(this.coverImagesList={})},handleUploadAuth:function(){var t=this,e=this.$store.getters.token;this.uploadHeaders.Authorization="Bearer "+e,Object(n.a)(e).then(function(e){t.uploadParams.userId=e.data.id})},handleRemove:function(t,e){this.$notify.info({title:this.$t("knowledge.cancelImage"),message:this.$t("knowledge.uploadAgainTips"),duration:3e3})},uploadSuccess:function(t,e,s){0===t.code&&(this.$notify.info({title:this.$t("knowledge.uploadCoverSuccess"),message:this.$t("knowledge.creatingKnowledgeNow"),duration:2e3}),this.ruleForm.cover_image=t.data.id,"create"===this.dialogStatus?this.createKnowledge():"update"===this.dialogStatus&&this.updateKnowledge())},handleCreate:function(t){var e=this;console.log(this.$refs.upload),this.resetForm("ruleForm"),this.dialogStatus="create",this.typeStatus=t,this.showDialogForm=!0,this.ruleForm.type=this.typeStatus,this.$nextTick(function(){e.$refs.ruleForm.clearValidate()})},createKnowledge:function(){var t=this;this.$refs.ruleForm.validate(function(e){if(!e)return!1;var s;(s=t.ruleForm,Object(l.a)({url:"/knowledge/"+s.name,method:"post",data:s})).then(function(e){t.getList(),t.showDialogForm=!1,t.$message({message:t.$t("common.createSucceeded"),type:"success",duration:2e3})})})},updateKnowledge:function(){var t=this;this.$refs.ruleForm.validate(function(e){if(!e)return!1;var s,a;(s=t.ruleForm.id,a=t.ruleForm,Object(l.a)({url:"/knowledge/"+s,method:"put",data:a})).then(function(e){t.getList(),t.showDialogForm=!1,t.$message({message:t.$t("common.updateSucceeded"),type:"success",duration:2e3})})})},submitUpdateKnowledge:function(){this.$refs.upload.uploadFiles[0]?this.$refs.upload.submit():this.updateKnowledge()},submitKnowledge:function(){this.$refs.upload.uploadFiles[0]?this.$refs.upload.submit():this.createKnowledge()},getList:function(){var t=this;Object(l.a)({url:"/knowledge",method:"get"}).then(function(e){t.noteList=e.data.note,t.docList=e.data.doc})},handleUpdate:function(t,e){var s,a=this;this.$refs.upload&&console.log(this.$refs.upload.uploadFiles[0]),(s=t,Object(l.a)({url:"/knowledge/"+s,method:"get"})).then(function(t){a.ruleForm.id=t.data.id,a.ruleForm.name=t.data.name,a.ruleForm.slug=t.data.slug,a.ruleForm.description=t.data.description,0!==t.data.cover_image_id&&(a.ruleForm.cover_image=t.data.cover_image_id,a.coverImagesList={name:t.data.cover_image_name,url:t.data.cover_image_url})}),this.resetForm("ruleForm"),this.dialogStatus="update",this.typeStatus=e,this.ruleForm.type=this.typeStatus,this.showDialogForm=!0,this.$nextTick(function(){a.$refs.ruleForm.clearValidate()})},handleStartWriting:function(t,e){this.$router.push({path:"/knowledge/edit/"+e+"/"+t})}}},c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-button",{staticClass:"filter-item",staticStyle:{"margin-right":"10px","margin-bottom":"20px"},attrs:{type:"small",icon:"el-icon-plus"},on:{click:function(e){return t.handleCreate("note")}}},[t._v(t._s(t.$t("knowledge.newNote")))]),t._v(" "),s("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px","margin-bottom":"20px"},attrs:{type:"small",icon:"el-icon-plus"},on:{click:function(e){return t.handleCreate("doc")}}},[t._v(t._s(t.$t("knowledge.newDoc")))]),t._v(" "),s("el-card",{staticClass:"box-card setting-form",staticStyle:{"margin-bottom":"15px"},attrs:{shadow:"hover"}},[s("div",{staticClass:"setting-form-header clearfix",attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"setting-header-title"},[t._v(t._s(t.$t("knowledge.notebook")))]),t._v(" "),s("span",{staticClass:"setting-header-subtitle"},[t._v(t._s(t.$t("knowledge.noteDesc")))])]),t._v(" "),s("el-row",t._l(t.noteList,function(e){return s("el-col",{key:e.id,attrs:{span:4}},[s("el-card",{staticClass:"k-card",attrs:{"body-style":{padding:"0px"},shadow:"hover"}},[""!=e.cover_image_url?s("img",{staticClass:"k-image",attrs:{src:e.cover_image_url}}):s("img",{staticClass:"k-image",attrs:{src:t.defaultCover}}),t._v(" "),s("div",{staticStyle:{padding:"14px"}},[s("a",{on:{click:function(s){return t.handleUpdate(e.id,"note")}}},[s("b",[t._v(t._s(e.name))]),s("el-button",{attrs:{type:"text",icon:"el-icon-edit"}})],1),t._v(" "),s("div",{staticClass:"k-bottom clearfix"},[s("time",{staticClass:"time"},[t._v(t._s(e.last_updated))]),t._v(" "),s("el-button",{staticClass:"k-button",attrs:{type:"text",size:"mini",round:"",plain:""},on:{click:function(s){return t.handleStartWriting(e.id,"note")}}},[t._v(t._s(t.$t("knowledge.startWrite")))])],1)])])],1)}),1)],1),t._v(" "),s("el-card",{staticClass:"box-card setting-form",attrs:{shadow:"hover"}},[s("div",{staticClass:"setting-form-header clearfix",attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"setting-header-title"},[t._v(t._s(t.$t("knowledge.documentSet")))]),t._v(" "),s("span",{staticClass:"setting-header-subtitle"},[t._v(t._s(t.$t("knowledge.docDesc")))])]),t._v(" "),s("el-row",t._l(t.docList,function(e){return s("el-col",{key:e.id,attrs:{span:4}},[s("el-card",{staticClass:"k-card",attrs:{"body-style":{padding:"0px"},shadow:"hover"}},[""!=e.cover_image_url?s("img",{staticClass:"k-image",attrs:{src:e.cover_image_url}}):s("img",{staticClass:"k-image",attrs:{src:t.defaultCover}}),t._v(" "),s("div",{staticStyle:{padding:"14px"}},[s("a",{on:{click:function(s){return t.handleUpdate(e.id,"doc")}}},[s("b",[t._v(t._s(e.name))]),s("el-button",{attrs:{type:"text",icon:"el-icon-edit"}})],1),t._v(" "),s("div",{staticClass:"k-bottom clearfix"},[s("time",{staticClass:"time"},[t._v(t._s(e.last_updated))]),t._v(" "),s("el-button",{staticClass:"k-button",attrs:{type:"text",size:"mini",round:"",plain:""},on:{click:function(s){return t.handleStartWriting(e.id,"doc")}}},[t._v(t._s(t.$t("knowledge.startWrite")))])],1)])])],1)}),1)],1),t._v(" "),s("el-dialog",{attrs:{title:t.$t("knowledge."+t.statusMap[t.dialogStatus]+t.typeMap[t.typeStatus]),visible:t.showDialogForm},on:{"update:visible":function(e){t.showDialogForm=e}}},[s("el-form",{ref:"ruleForm",staticClass:"ruleFrom",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px",size:"medium"}},[s("el-form-item",{attrs:{label:t.$t("knowledge.knowledgeType"),prop:"type"}},[s("span",[t._v(t._s(t.$t("knowledge."+t.ruleForm.type)))])]),t._v(" "),s("el-form-item",{attrs:{label:t.$t("knowledge.knowledgeName"),prop:"name"}},[s("el-input",{model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:t.$t("knowledge.knowledgeSlug"),prop:"slug"}},[s("el-input",{model:{value:t.ruleForm.slug,callback:function(e){t.$set(t.ruleForm,"slug",e)},expression:"ruleForm.slug"}})],1),t._v(" "),s("el-form-item",{attrs:{label:t.$t("knowledge.knowledgeDescription"),prop:"description"}},[s("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:t.ruleForm.description,callback:function(e){t.$set(t.ruleForm,"description",e)},expression:"ruleForm.description"}}),t._v(" "),s("p",{staticClass:"setting-form-desc"},[t._v(t._s(t.$t("knowledge.knowledgeDescriptionDesc")))])],1),t._v(" "),s("el-form-item",{attrs:{label:t.$t("knowledge.knowledgeCoverImage")}},[s("el-upload",{ref:"upload",attrs:{action:t.uploadUrl,headers:t.uploadHeaders,data:t.uploadParams,"auto-upload":!1,limit:t.limitUploadNumber,"on-success":t.uploadSuccess,"on-remove":t.handleRemove,"list-type":"picture"}},[s("el-button",{attrs:{slot:"trigger",size:"mini",type:"primary"},slot:"trigger"},[t._v("选择图片")]),t._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件")])],1),t._v(" "),s("p",{staticClass:"setting-form-desc"},[t._v(t._s(t.$t("knowledge.knowledgeCoverImageDesc")))])],1),t._v(" "),"{}"!==JSON.stringify(t.coverImagesList)?s("el-form-item",[s("div",{staticClass:"block"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("当前封面图")]),t._v(" "),s("el-image",{attrs:{src:t.coverImagesList.url,fit:"contain"}},[s("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-picture-outline"})])])],1)]):t._e(),t._v(" "),s("el-form-item",["create"==t.dialogStatus?s("el-button",{attrs:{type:"primary"},on:{click:t.submitKnowledge}},[t._v(t._s(t.$t("knowledge.createNow")))]):s("el-button",{attrs:{type:"primary"},on:{click:t.submitUpdateKnowledge}},[t._v(t._s(t.$t("common.save")))]),t._v(" "),"create"==t.dialogStatus?s("el-button",{on:{click:function(e){return t.resetForm("ruleForm")}}},[t._v(t._s(t.$t("common.reset")))]):s("el-button",{on:{click:function(e){t.showDialogForm=!1}}},[t._v(t._s(t.$t("common.cancel")))])],1)],1)],1)],1)},staticRenderFns:[]};var u=s("VU/8")(d,c,!1,function(t){s("7sEC")},null,null);e.default=u.exports},gxl0:function(t,e,s){(t.exports=s("FZ+f")(!1)).push([t.i,"\n.k-card{\n  margin-right: 15px;\n}\n.k-image {\n  width: 100%;\n  display: block;\n}\n.k-button {\n  float: right;\n}\n",""])},mvHQ:function(t,e,s){t.exports={default:s("qkKv"),__esModule:!0}},odxq:function(t,e,s){t.exports=s.p+"static/img/write.5bfe9f3.png"},qkKv:function(t,e,s){var a=s("FeBl"),i=a.JSON||(a.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}}});