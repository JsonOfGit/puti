webpackJsonp([2],{"0QkR":function(t,n,e){"use strict";n.b=function(){return Object(a.a)({url:"/subject",method:"get"})},n.a=function(t){return Object(a.a)({url:"/subject/"+t.name,method:"post",data:t})},n.c=function(t){return Object(a.a)({url:"/subject/"+t,method:"get"})},n.d=function(t,n){return Object(a.a)({url:"/subject/"+t,method:"put",data:n})};var a=e("vLgD")},"5zOK":function(t,n,e){var a=e("Zym2");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);e("rjj0")("6e798532",a,!0)},"E/TR":function(t,n){t.exports=function(){return Function.call.apply(Array.prototype.concat,arguments)}},"JuR+":function(t,n,e){(t.exports=e("FZ+f")(!1)).push([t.i,'\n.ms-tree-space[data-v-51226dd0] {\n  position: relative;\n  top: 1px;\n  display: inline-block;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 1;\n  width: 18px;\n  height: 14px;\n}\n.ms-tree-space[data-v-51226dd0]::before {\n    content: "";\n}\n.processContainer[data-v-51226dd0] {\n  width: 100%;\n  height: 100%;\n}\ntable td[data-v-51226dd0] {\n  line-height: 26px;\n}\n.tree-ctrl[data-v-51226dd0] {\n  position: relative;\n  cursor: pointer;\n  color: #2196F3;\n  margin-left: -18px;\n}\n',""])},P3vl:function(t,n,e){(t.exports=e("FZ+f")(!1)).push([t.i,"\n@keyframes treeTableShow {\nfrom {opacity: 0;\n}\nto {opacity: 1;\n}\n}\n@-webkit-keyframes treeTableShow {\nfrom {opacity: 0;\n}\nto {opacity: 1;\n}\n}\n",""])},SeII:function(t,n,e){var a=e("P3vl");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);e("rjj0")("3042b006",a,!0)},Zym2:function(t,n,e){(t.exports=e("FZ+f")(!1)).push([t.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},dXij:function(t,n,e){t.exports={default:e("E/TR"),__esModule:!0}},s3ol:function(t,n,e){"use strict";var a=e("dXij"),i=e.n(a),o=e("c/Tr"),s=e.n(o),r=e("/5sW");function l(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=[];return s()(t).forEach(function(t){void 0===t._expanded&&r.default.set(t,"_expanded",n);var o=1;if(void 0!==a&&null!==a&&(o=a+1),r.default.set(t,"_level",o),e&&r.default.set(t,"parent",e),i.push(t),t.children&&t.children.length>0){var s=l(t.children,n,t,o);i=i.concat(s)}}),i}var d={name:"treeTable",props:{data:{type:[Array,Object],required:!0},columns:{type:Array,default:function(){return[]}},evalFunc:Function,evalArgs:Array,expandAll:{type:Boolean,default:!0}},computed:{formatData:function(){var t=void 0;t=Array.isArray(this.data)?this.data:[this.data];var n=this.evalFunc||l,e=this.evalArgs?i()([t,this.expandAll],this.evalArgs):[t,this.expandAll];return n.apply(null,e)}},methods:{showRow:function(t){var n=!t.row.parent||t.row.parent._expanded&&t.row.parent._show;return t.row._show=n,n?"animation:treeTableShow 1s;-webkit-animation:treeTableShow 1s;":"display:none;"},toggleExpanded:function(t){var n=this.formatData[t];n._expanded=!n._expanded},iconShow:function(t,n){return 0===t&&n.children&&n.children.length>0}}},c={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("el-table",t._b({attrs:{data:t.formatData,"row-style":t.showRow}},"el-table",t.$attrs,!1),[0===t.columns.length?e("el-table-column",{attrs:{width:"150"},scopedSlots:t._u([{key:"default",fn:function(n){return[t._l(n.row._level,function(t){return e("span",{key:t,staticClass:"ms-tree-space"})}),t._v(" "),t.iconShow(0,n.row)?e("span",{staticClass:"tree-ctrl",on:{click:function(e){t.toggleExpanded(n.$index)}}},[n.row._expanded?e("i",{staticClass:"el-icon-caret-bottom"}):e("i",{staticClass:"el-icon-caret-right"})]):t._e(),t._v("\n      "+t._s(n.$index)+"\n    ")]}}])}):t._l(t.columns,function(n,a){return e("el-table-column",{key:n.value,attrs:{label:n.text,width:n.width},scopedSlots:t._u([{key:"default",fn:function(i){return[t._l(i.row._level,function(n){return 0===a?e("span",{key:n,staticClass:"ms-tree-space"}):t._e()}),t._v(" "),t.iconShow(a,i.row)?e("span",{staticClass:"tree-ctrl",on:{click:function(n){t.toggleExpanded(i.$index)}}},[i.row._expanded?e("i",{staticClass:"el-icon-caret-bottom"}):e("i",{staticClass:"el-icon-caret-right"})]):t._e(),t._v("\n      "+t._s(i.row[n.value])+"\n    ")]}}])})}),t._v(" "),t._t("default")],2)},staticRenderFns:[]};var u=e("VU/8")(d,c,!1,function(t){e("SeII"),e("xPaY")},"data-v-51226dd0",null);n.a=u.exports},suOz:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("0QkR"),i=e("M9A7"),o={name:"subject-list",components:{treeTable:e("s3ol").a},data:function(){return{columns:[{text:this.$t("subject.name"),value:"name",width:230},{text:this.$t("subject.slug"),value:"slug",width:200},{text:this.$t("subject.description"),value:"description"},{text:this.$t("subject.lastUpdated"),value:"last_updated",width:200},{text:this.$t("subject.totalPost"),value:"count",width:100}],data:[],listLoading:!0,labelPosition:"right",editDialogVisible:!1,editDialogTitle:"Edit",editForm:{id:void 0,name:"",slug:"",parent_id:0,cover_image:0,description:""},editDialogImgFileList:[],parentProps:{label:"name",value:"id"},updateParentId:[],nowCoverPicture:{},limitUploadNumber:1,uploadUrl:"/api/media",uploadHeaders:{Authorization:""},uploadParams:{userId:"",usage:"cover"}}},created:function(){this.setTitle(),this.getList()},methods:{setTitle:function(){document.title=this.$t("route."+this.$route.meta.title)+" | Puti"},getList:function(){var t=this;this.listLoading=!0,Object(a.b)().then(function(n){t.data=n.data,t.listLoading=!1})},handleUploadAuth:function(){var t=this,n=this.$store.getters.token;this.uploadHeaders.Authorization="Bearer "+n,Object(i.a)(n).then(function(n){t.uploadParams.userId=n.data.id})},handleEditSubject:function(t){var n=this;Object(a.c)(t).then(function(t){n.editForm.id=t.data.id,n.editForm.name=t.data.name,n.editForm.slug=t.data.slug,n.editForm.parent_id=t.data.parent_id,n.editForm.cover_image=t.data.cover_image,n.editForm.description=t.data.description,n.updateParentId=n.getParentArr(t.data),n.nowCoverPicture={id:t.data.cover_image,name:t.data.name,url:t.data.cover_url,status:t.data.cover_image_status},console.log(n.editForm),n.editDialogVisible=!0,n.editDialogTitle=t.data.name})},handleParent:function(t,n,e){for(var a=0;a<=t.length-1;a++)if(void 0!==t[a]&&a===n){e.push(t[a]),e=this.handleParent(t,t[a],e);break}return e},getParentArr:function(t){var n=[];if(0!==t.parent_id){var e=this.getParent(this.data,t.parent_id,[]);n.push(e[0]),n=this.handleParent(e,e[0],n)}return n},getParent:function(t,n,e){var a=this.getUpdateParentId(t,n,[]);return e[a.parent_id]=a.id,0!==a.parent_id&&(e=this.getParent(t,a.parent_id,e)),e},getUpdateParentId:function(t,n,e){for(var a=0;a<=t.length-1;a++){if(n===t[a].id){e.id=t[a].id,e.parent_id=t[a].parent_id,0!==t[a].parent_id&&(e=this.getUpdateParentId(t,t[a].parent_id,e));break}null!==t[a].children&&(e=this.getUpdateParentId(t[a].children,n,e))}return e},handleChangeParent:function(t){if(t.length>0){var n=t[t.length-1];this.editForm.id===n&&(this.updateParentId=[],this.$message.error(this.$t("subject.parentCannotBeSelf"))),this.editForm.parent_id=n}else this.editForm.parent_id=0;console.log(this.editForm)},handleRemove:function(t,n){this.$notify.info({title:this.$t("subject.cancelImage"),message:this.$t("subject.uploadAgainTips"),duration:3e3})},uploadSuccess:function(t,n,e){0===t.code&&(this.$notify.info({title:this.$t("subject.uploadCoverSuccess"),message:this.$t("subject.updatingSubjectNow"),duration:2e3}),this.editForm.cover_image=t.data.id,this.updateSubject())},submitUpdate:function(){this.$refs.upload.uploadFiles[0]?this.$refs.upload.submit():this.updateSubject()},updateSubject:function(){var t=this;this.editDialogVisible=!1,Object(a.d)(this.editForm.id,this.editForm).then(function(n){t.$notify.success({title:t.$t("common.operationSucceeded"),message:t.$t("subject.updateSubjectSuccess"),duration:3e3}),t.getList()})},openUpdateDialog:function(){this.handleUploadAuth()},closeUpdateDialog:function(){this.editDialogImgFileList=[]}}},s={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"app-container"},[e("tree-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.data,columns:t.columns,"max-height":"800",border:""}},[e("el-table-column",{attrs:{label:t.$t("common.action"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini",circle:""},on:{click:function(e){t.handleEditSubject(n.row.id)}}}),t._v(" "),null==n.row.children?e("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(e){t.handleDelete(n.row)}}}):t._e()]}}])})],1),t._v(" "),e("el-dialog",{attrs:{title:t.editDialogTitle,visible:t.editDialogVisible,width:"70%"},on:{"update:visible":function(n){t.editDialogVisible=n},open:t.openUpdateDialog,close:t.closeUpdateDialog}},[e("el-form",{attrs:{model:t.editForm,size:"small","label-position":t.labelPosition,"label-width":"100px"}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{xs:24,sm:24,md:16,xl:16}},[e("el-form-item",{attrs:{label:t.$t("subject.subjectName")}},[e("el-input",{model:{value:t.editForm.name,callback:function(n){t.$set(t.editForm,"name",n)},expression:"editForm.name"}}),t._v(" "),e("p",{staticClass:"setting-form-desc"},[t._v(t._s(t.$t("subject.subjectNameDesc")))])],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("subject.subjectSlug")}},[e("el-input",{model:{value:t.editForm.slug,callback:function(n){t.$set(t.editForm,"slug",n)},expression:"editForm.slug"}}),t._v(" "),e("p",{staticClass:"setting-form-desc"},[t._v(t._s(t.$t("subject.subjectSlugDesc")))])],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("subject.parentSubject")}},[e("el-cascader",{attrs:{placeholder:t.$t("subject.parentSubjectPlaceholder"),options:t.data,props:t.parentProps,"change-on-select":"",clearable:""},on:{change:t.handleChangeParent},model:{value:t.updateParentId,callback:function(n){t.updateParentId=n},expression:"updateParentId"}}),t._v(" "),e("p",{staticClass:"setting-form-desc"},[t._v(t._s(t.$t("subject.parentSubjectDesc")))])],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("subject.subjectDescription")}},[e("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:t.editForm.description,callback:function(n){t.$set(t.editForm,"description",n)},expression:"editForm.description"}}),t._v(" "),e("p",{staticClass:"setting-form-desc"},[t._v(t._s(t.$t("subject.subjectDescriptionDesc")))])],1)],1),t._v(" "),e("el-col",{attrs:{xs:24,sm:24,md:8,xl:8}},[e("el-form-item",{attrs:{label:t.$t("subject.subjectCoverPictureNow")}},[0===t.nowCoverPicture.id?e("div",[t._v("\n                无\n              ")]):e("div",[""!=t.nowCoverPicture.status?e("span",[t._v(t._s(t.nowCoverPicture.status))]):e("img",{attrs:{src:t.nowCoverPicture.url}})])]),t._v(" "),e("el-form-item",{attrs:{label:t.$t("subject.subjectCoverPictureChange")}},[e("el-upload",{ref:"upload",attrs:{action:t.uploadUrl,headers:t.uploadHeaders,data:t.uploadParams,"auto-upload":!1,limit:t.limitUploadNumber,"on-success":t.uploadSuccess,"on-remove":t.handleRemove,"file-list":t.editDialogImgFileList,"list-type":"picture"}},[e("el-button",{attrs:{slot:"trigger",size:"mini",type:"primary"},slot:"trigger"},[t._v("选择图片")]),t._v(" "),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件")])],1),t._v(" "),e("p",{staticClass:"setting-form-desc"},[t._v(t._s(t.$t("subject.subjectCoverPictureDesc")))])],1)],1)],1)],1),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(n){t.editDialogVisible=!1}}},[t._v(t._s(t.$t("common.cancel")))]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(n){t.submitUpdate()}}},[t._v(t._s(t.$t("common.confirm")))])],1)],1)],1)},staticRenderFns:[]};var r=e("VU/8")(o,s,!1,function(t){e("5zOK")},null,null);n.default=r.exports},xPaY:function(t,n,e){var a=e("JuR+");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);e("rjj0")("29576f66",a,!0)}});