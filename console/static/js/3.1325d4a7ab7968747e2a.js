webpackJsonp([3],{"7eIS":function(e,n,t){(e.exports=t("FZ+f")(!1)).push([e.i,"\n@keyframes treeTableShow {\nfrom {\n    opacity: 0;\n}\nto {\n    opacity: 1;\n}\n}\n@-webkit-keyframes treeTableShow {\nfrom {\n    opacity: 0;\n}\nto {\n    opacity: 1;\n}\n}\n.tree-ctrl {\n  position: relative;\n  cursor: pointer;\n  color: #2196f3;\n}\n",""])},DnA7:function(e,n,t){var i=t("n4/g");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);t("rjj0")("49f6484c",i,!0)},ZbqW:function(e,n,t){var i=t("7eIS");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);t("rjj0")("356105e9",i,!0)},"n4/g":function(e,n,t){(e.exports=t("FZ+f")(!1)).push([e.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},s3ol:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("/5sW");function a(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.parent,s=void 0===t?null:t,l=n.preIndex,o=void 0!==l&&l,r=n.level,d=void 0===r?0:r,c=n.expand,u=void 0!==c&&c,p=n.children,h=void 0===p?"children":p,m=n.show,f=void 0===m||m,g=n.select,v=void 0!==g&&g;e.forEach(function(e,n){var t=(o?o+"-"+n:n)+"";i.default.set(e,"_id",t),i.default.set(e,"_level",d),i.default.set(e,"_expand",u),i.default.set(e,"_parent",s),i.default.set(e,"_show",f),i.default.set(e,"_select",v),e[h]&&e[h].length>0&&a(e[h],{parent:e,level:d+1,expand:u,preIndex:t,children:h,status:status,select:v})})}var s=t("//Fk"),l=t.n(s),o={name:"TreeTable",props:{data:{type:Array,required:!0,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},defaultExpandAll:{type:Boolean,default:!1},defaultChildren:{type:String,default:"children"},indent:{type:Number,default:50}},data:function(){return{guard:1}},computed:{children:function(){return this.defaultChildren},tableData:function(){var e=this.data;return 0===this.data.length?[]:(a(e,{expand:this.defaultExpandAll,children:this.defaultChildren}),function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"children",a=[];return n.forEach(function(n,s){if(i.default.set(n,"_index",s),a.push(n),n[t]&&n[t].length>0){var l=e(n[t],t);a=a.concat(l)}}),a}(e,this.defaultChildren))}},methods:{addBrother:function(e,n){e._parent?e._parent.children.push(n):this.data.push(n)},addChild:function(e,n){e.children||this.$set(e,"children",[]),e.children.push(n)},delete:function(e){var n=e._index,t=e._parent;t?t.children.splice(n,1):this.data.splice(n,1)},getData:function(){return this.tableData},showRow:function(e){var n=e.row,t=n._parent,i=!t||t._expand&&t._show;return n._show=i,i?"animation:treeTableShow 1s;-webkit-animation:treeTableShow 1s;":"display:none;"},showSperadIcon:function(e){return e[this.children]&&e[this.children].length>0},toggleExpanded:function(e){var n=this.tableData[e],t=!n._expand;n._expand=t},handleCheckAllChange:function(e){this.selcetRecursion(e,e._select,this.defaultChildren),this.isIndeterminate=e._select},selcetRecursion:function(e,n){var t=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"children";n&&(this.$set(e,"_expand",!0),this.$set(e,"_show",!0));var a=e[i];a&&a.length>0&&a.map(function(e){e._select=n,t.selcetRecursion(e,n,i)})},updateTreeNode:function(e){var n=this;return new l.a(function(t){var i=e._id,a=e._parent,s=i.split("-").slice(-1)[0];a?(a.children.splice(s,1,e),t(n.data)):(n.data.splice(s,1,e),t(n.data))})}}},r={render:function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("el-table",e._g(e._b({attrs:{data:e.tableData,"row-style":e.showRow}},"el-table",e.$attrs,!1),e.$listeners),[e._t("selection"),e._v(" "),e._t("pre-column"),e._v(" "),e._l(e.columns,function(n){return t("el-table-column",{key:n.key,attrs:{label:n.label,width:n.width,align:n.align||"center","header-align":n.headerAlign},scopedSlots:e._u([{key:"default",fn:function(i){return[e._t(n.key,[n.expand?[t("span",{style:{"padding-left":+i.row._level*e.indent+"px"}}),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.showSperadIcon(i.row),expression:"showSperadIcon(scope.row)"}],staticClass:"tree-ctrl",on:{click:function(n){e.toggleExpanded(i.$index)}}},[i.row._expand?t("i",{staticClass:"el-icon-minus"}):t("i",{staticClass:"el-icon-plus"})])]:e._e(),e._v(" "),n.checkbox?[i.row[e.defaultChildren]&&i.row[e.defaultChildren].length>0?t("el-checkbox",{style:{"padding-left":+i.row._level*e.indent+"px"},attrs:{indeterminate:i.row._select},on:{change:function(n){e.handleCheckAllChange(i.row)}},model:{value:i.row._select,callback:function(n){e.$set(i.row,"_select",n)},expression:"scope.row._select"}}):t("el-checkbox",{style:{"padding-left":+i.row._level*e.indent+"px"},on:{change:function(n){e.handleCheckAllChange(i.row)}},model:{value:i.row._select,callback:function(n){e.$set(i.row,"_select",n)},expression:"scope.row._select"}})]:e._e(),e._v("\n        "+e._s(i.row[n.key])+"\n      ")],{scope:i})]}}])})})],2)},staticRenderFns:[]};var d=t("VU/8")(o,r,!1,function(e){t("ZbqW")},null,null);n.a=d.exports},suOz:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("0QkR"),a=t("M9A7"),s={name:"subject-list",components:{treeTable:t("s3ol").a},data:function(){return{columns:[{label:this.$t("subject.name"),key:"name",expand:!0,width:230,align:"left"},{label:this.$t("subject.slug"),key:"slug",width:200,align:"left"},{label:this.$t("subject.description"),key:"description",align:"left"},{label:this.$t("subject.lastUpdated"),key:"last_updated",width:200,align:"center"},{label:this.$t("subject.totalPost"),key:"count",width:100,align:"center"},{label:this.$t("common.action"),key:"action",width:150,align:"center"}],data:[],listLoading:!0,labelPosition:"right",editDialogVisible:!1,editDialogTitle:"Edit",editForm:{id:void 0,name:"",slug:"",parent_id:0,cover_image:0,description:""},editDialogImgFileList:[],parentProps:{label:"name",value:"id"},updateParentId:[],nowCoverPicture:{},limitUploadNumber:1,uploadUrl:"/api/media",uploadHeaders:{Authorization:""},uploadParams:{userId:"",usage:"cover"}}},created:function(){this.setTitle(),this.getList()},methods:{setTitle:function(){document.title=this.$t("route."+this.$route.meta.title)+" | Puti"},getList:function(){var e=this;this.listLoading=!0,i.c().then(function(n){e.data=n.data,e.listLoading=!1})},handleUploadAuth:function(){var e=this,n=this.$store.getters.token;this.uploadHeaders.Authorization="Bearer "+n,a.a(n).then(function(n){e.uploadParams.userId=n.data.id})},handleEditSubject:function(e){var n=this;i.d(e).then(function(e){n.editForm.id=e.data.id,n.editForm.name=e.data.name,n.editForm.slug=e.data.slug,n.editForm.parent_id=e.data.parent_id,n.editForm.cover_image=e.data.cover_image,n.editForm.description=e.data.description,n.updateParentId=n.getParentArr(e.data),n.nowCoverPicture={id:e.data.cover_image,name:e.data.name,url:e.data.cover_url,status:e.data.cover_image_status},n.editDialogVisible=!0,n.editDialogTitle=e.data.name})},handleParent:function(e,n,t){for(var i=0;i<=e.length-1;i++)if(void 0!==e[i]&&i===n){t.push(e[i]),t=this.handleParent(e,e[i],t);break}return t},getParentArr:function(e){var n=[];if(0!==e.parent_id){var t=this.getParent(this.data,e.parent_id,[]);n.push(t[0]),n=this.handleParent(t,t[0],n)}return n},getParent:function(e,n,t){var i=this.getUpdateParentId(e,n,[]);return t[i.parent_id]=i.id,0!==i.parent_id&&(t=this.getParent(e,i.parent_id,t)),t},getUpdateParentId:function(e,n,t){for(var i=0;i<=e.length-1;i++){if(n===e[i].id){t.id=e[i].id,t.parent_id=e[i].parent_id,0!==e[i].parent_id&&(t=this.getUpdateParentId(e,e[i].parent_id,t));break}null!==e[i].children&&(t=this.getUpdateParentId(e[i].children,n,t))}return t},handleChangeParent:function(e){if(e.length>0){var n=e[e.length-1];this.editForm.id===n&&(this.updateParentId=[],this.$message.error(this.$t("subject.parentCannotBeSelf"))),this.editForm.parent_id=n}else this.editForm.parent_id=0;console.log(this.editForm)},handleRemove:function(e,n){this.$notify.info({title:this.$t("subject.cancelImage"),message:this.$t("subject.uploadAgainTips"),duration:3e3})},uploadSuccess:function(e,n,t){0===e.code&&(this.$notify.info({title:this.$t("subject.uploadCoverSuccess"),message:this.$t("subject.updatingSubjectNow"),duration:2e3}),this.editForm.cover_image=e.data.id,this.updateSubject())},submitUpdate:function(){this.$refs.upload.uploadFiles[0]?this.$refs.upload.submit():this.updateSubject()},updateSubject:function(){var e=this;this.editDialogVisible=!1,i.e(this.editForm.id,this.editForm).then(function(n){e.$notify.success({title:e.$t("common.operationSucceeded"),message:e.$t("subject.updateSubjectSuccess"),duration:3e3}),e.getList()})},openUpdateDialog:function(){this.handleUploadAuth()},closeUpdateDialog:function(){this.editDialogImgFileList=[]},handleDelete:function(e){var n=this;this.$confirm(this.$t("subject.confirmToDeleteSubject"),this.$t("common.tips"),{confirmButtonText:this.$t("common.confirm"),cancelButtonText:this.$t("common.cancel"),type:"warning",center:!0}).then(function(){i.b(e.id).then(function(e){n.getList(),n.$message({type:"success",message:n.$t("common.deleteSucceeded")})})}).catch(function(){n.$message({type:"info",message:n.$t("common.cancelDelete")})})}}},l={render:function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"app-container"},[t("tree-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.data,columns:e.columns,defaultExpandAll:"","max-height":"800",border:""},scopedSlots:e._u([{key:"action",fn:function(n){var i=n.scope;return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini",circle:""},on:{click:function(n){e.handleEditSubject(i.row.id)}}}),e._v(" "),null==i.row.children?t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(n){e.handleDelete(i.row)}}}):e._e()]}}])}),e._v(" "),t("el-dialog",{attrs:{title:e.editDialogTitle,visible:e.editDialogVisible,width:"70%"},on:{"update:visible":function(n){e.editDialogVisible=n},open:e.openUpdateDialog,close:e.closeUpdateDialog}},[t("el-form",{attrs:{model:e.editForm,size:"small","label-position":e.labelPosition,"label-width":"100px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{xs:24,sm:24,md:16,xl:16}},[t("el-form-item",{attrs:{label:e.$t("subject.subjectName")}},[t("el-input",{model:{value:e.editForm.name,callback:function(n){e.$set(e.editForm,"name",n)},expression:"editForm.name"}}),e._v(" "),t("p",{staticClass:"setting-form-desc"},[e._v(e._s(e.$t("subject.subjectNameDesc")))])],1),e._v(" "),t("el-form-item",{attrs:{label:e.$t("subject.subjectSlug")}},[t("el-input",{model:{value:e.editForm.slug,callback:function(n){e.$set(e.editForm,"slug",n)},expression:"editForm.slug"}}),e._v(" "),t("p",{staticClass:"setting-form-desc"},[e._v(e._s(e.$t("subject.subjectSlugDesc")))])],1),e._v(" "),t("el-form-item",{attrs:{label:e.$t("subject.parentSubject")}},[t("el-cascader",{attrs:{placeholder:e.$t("subject.parentSubjectPlaceholder"),options:e.data,props:e.parentProps,"change-on-select":"",clearable:""},on:{change:e.handleChangeParent},model:{value:e.updateParentId,callback:function(n){e.updateParentId=n},expression:"updateParentId"}}),e._v(" "),t("p",{staticClass:"setting-form-desc"},[e._v(e._s(e.$t("subject.parentSubjectDesc")))])],1),e._v(" "),t("el-form-item",{attrs:{label:e.$t("subject.subjectDescription")}},[t("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:e.editForm.description,callback:function(n){e.$set(e.editForm,"description",n)},expression:"editForm.description"}}),e._v(" "),t("p",{staticClass:"setting-form-desc"},[e._v(e._s(e.$t("subject.subjectDescriptionDesc")))])],1)],1),e._v(" "),t("el-col",{attrs:{xs:24,sm:24,md:8,xl:8}},[t("el-form-item",{attrs:{label:e.$t("subject.subjectCoverPictureNow")}},[0===e.nowCoverPicture.id?t("div",[e._v("\n                无\n              ")]):t("div",[""!=e.nowCoverPicture.status?t("span",[e._v(e._s(e.nowCoverPicture.status))]):t("img",{staticStyle:{"max-width":"90%"},attrs:{src:e.nowCoverPicture.url}})])]),e._v(" "),t("el-form-item",{attrs:{label:e.$t("subject.subjectCoverPictureChange")}},[t("el-upload",{ref:"upload",attrs:{action:e.uploadUrl,headers:e.uploadHeaders,data:e.uploadParams,"auto-upload":!1,limit:e.limitUploadNumber,"on-success":e.uploadSuccess,"on-remove":e.handleRemove,"file-list":e.editDialogImgFileList,"list-type":"picture"}},[t("el-button",{attrs:{slot:"trigger",size:"mini",type:"primary"},slot:"trigger"},[e._v("选择图片")]),e._v(" "),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件")])],1),e._v(" "),t("p",{staticClass:"setting-form-desc"},[e._v(e._s(e.$t("subject.subjectCoverPictureDesc")))])],1)],1)],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(n){e.editDialogVisible=!1}}},[e._v(e._s(e.$t("common.cancel")))]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(n){e.submitUpdate()}}},[e._v(e._s(e.$t("common.confirm")))])],1)],1)],1)},staticRenderFns:[]};var o=t("VU/8")(s,l,!1,function(e){t("DnA7")},null,null);n.default=o.exports}});